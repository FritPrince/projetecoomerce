import{r as n,j as e,c as w,H as C,L as _,_ as E,y as P,f as T}from"./app-4QF1noMb.js";import{B as F}from"./button-DBIL1Z8B.js";import{C as m,a as f,b as y,d as u}from"./card-DR06hP1e.js";import{A as I}from"./arrow-left-C7Q7q3fr.js";import{C as q}from"./credit-card-yvDc5vsp.js";/* empty css            */import"./utils-BULDOeo9.js";import"./createLucideIcon-6dVE3Vd0.js";function U({commande:t,stripeKey:x,clientSecret:c,paymentIntentId:b}){const[o,N]=n.useState(null),[p,g]=n.useState(null),[h,d]=n.useState(!1),[j,r]=n.useState(null);n.useEffect(()=>{if(!c){r("Client Secret manquant. Veuillez r√©essayer.");return}(async()=>{try{const{loadStripe:s}=await E(async()=>{const{loadStripe:S}=await import("./index-CGQpDrwN.js");return{loadStripe:S}},[]),l=await s(x);if(!l)throw new Error("Impossible de charger Stripe");N(l);const i=l.elements({clientSecret:c,appearance:{theme:"stripe"}});g(i),i.create("payment",{layout:{type:"tabs",defaultCollapsed:!1}}).mount("#payment-element")}catch(s){console.error("Erreur lors du chargement de Stripe:",s),s.message&&s.message.includes("clientSecret should be a client secret")?r("Format de cl√© de paiement invalide. Veuillez r√©essayer."):r("Erreur lors du chargement du syst√®me de paiement")}})()},[x,c]);const v=async a=>{if(a.preventDefault(),!o||!p){r("Stripe n'est pas encore charg√©");return}d(!0),r(null);try{const{error:s}=await o.confirmPayment({elements:p,confirmParams:{return_url:`${window.location.origin}/payment/success/${t.id}`},redirect:"if_required"});if(s){r(s.message||"Une erreur est survenue lors du paiement"),d(!1);return}const i=await(await fetch(`/payment/stripe/process/${t.id}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({payment_intent_id:b})})).json();i.success?(P.success("Merci, votre commande a bien √©t√© re√ßue ! Vous recevrez bient√¥t une confirmation."),setTimeout(()=>T.visit("/"),2e3)):r(i.message||"Erreur lors de l'enregistrement du paiement")}catch(s){console.error("Erreur lors du traitement:",s),r("Une erreur inattendue est survenue")}finally{d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(w,{position:"top-right",theme:"colored"}),e.jsx(C,{title:"Paiement par carte"}),e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(_,{href:"/panier",className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Retour au panier"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Paiement par carte"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Finalisez votre commande #",t.numero_commande]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),"Informations de paiement"]})}),e.jsx(u,{children:e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsx("div",{id:"payment-element",className:"min-h-[200px]"}),j&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:j})}),e.jsx(F,{type:"submit",disabled:!o||h,className:"w-full",size:"lg",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Traitement en cours..."]}):`Payer ${Number(t.total).toFixed(2)} ‚Ç¨`})]})})]}),e.jsx(m,{className:"bg-blue-50 border-blue-200",children:e.jsxs(u,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Mode Test"}),e.jsx("p",{className:"text-sm text-blue-700 mb-2",children:"Utilisez les cartes de test suivantes :"}),e.jsxs("ul",{className:"text-xs text-blue-600 space-y-1",children:[e.jsxs("li",{children:["üí≥ Carte r√©ussie : ",e.jsx("code",{children:"4242 4242 4242 4242"})]}),e.jsx("li",{children:"üìÖ Date : n'importe quelle date future"}),e.jsx("li",{children:"üîí CVC : n'importe quel code √† 3 chiffres"})]})]})})]}),e.jsxs(m,{children:[e.jsx(f,{children:e.jsx(y,{children:"R√©capitulatif"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Commande"}),e.jsxs("p",{className:"font-medium",children:["#",t.numero_commande]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Produits"}),e.jsx("div",{className:"space-y-2 mt-2",children:t.produits&&t.produits.length>0?t.produits.map(a=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[a.nom," x",a.pivot.quantite]}),e.jsxs("span",{children:[Number(a.pivot.sous_total).toFixed(2)," ‚Ç¨"]})]},a.id)):e.jsx("p",{className:"text-sm text-gray-500",children:"Chargement des produits..."})})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Total"}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:[Number(t.total).toFixed(2)," ‚Ç¨"]})]})})]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Votre paiement est s√©curis√© et crypt√© par Stripe"})})]})]})}export{U as default};
